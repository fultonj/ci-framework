_osp_img_data: &osp_base_conf
  image_local_dir: "{{ cifmw_basedir }}/images/"
  disk_file_name: osp-base.qcow2
  image_url: "{{ osp_base_img_url | default(cifmw_discovered_image_url) }}"
  sha256_image_name: >-
    {{ osp_base_img_sha256 | default(cifmw_discovered_hash) }}

libvirt_manager_patch_layout:
  vms:
    osp-undercloud:
      <<: *osp_base_conf
      amount: 1
      memory: 16
      cpus: 8
      disksize: 80
      nets:
        - ocpbm
        - osp_trunk
    osp-controller:
      <<: *osp_base_conf
      amount: 1
      disksize: 50
      memory: 8
      cpus: 4
      nets:
        - ocpbm
        - osp_trunk
    # Let's remove the default computes, since we want to adopt the
    # OSP ones
    compute:
      amount: 0
    osp-compute:
      <<: *osp_base_conf
      amount: "{{ [cifmw_libvirt_manager_compute_amount|int, 3] | max }}"
      extra_disks_num: 3
      extra_disks_size: 15G
      disksize: "{{ [cifmw_libvirt_manager_compute_disksize|int, 50] | max }}"
      memory: "{{ [cifmw_libvirt_manager_compute_memory|int, 8] | max }}"
      cpus: "{{ [cifmw_libvirt_manager_compute_cpus|int, 4] | max }}"
      nets:
        - ocpbm
        - osp_trunk
    dcn1-compute-az1:
      amount: 0
    osp-dcn1-compute-az1:
      <<: *osp_base_conf
      amount: "{{ [cifmw_libvirt_manager_compute_amount|int, 3] | max }}"
      extra_disks_num: 3
      extra_disks_size: 15G
      disksize: "{{ [cifmw_libvirt_manager_compute_disksize|int, 50] | max }}"
      memory: "{{ [cifmw_libvirt_manager_compute_memory|int, 8] | max }}"
      cpus: "{{ [cifmw_libvirt_manager_compute_cpus|int, 4] | max }}"
      nets:
        - dcn1_pb
        - dcn1_tr
    dcn2-compute-az2:
      amount: 0
    osp-dcn2-compute-az2:
      <<: *osp_base_conf
      amount: "{{ [cifmw_libvirt_manager_compute_amount|int, 3] | max }}"
      extra_disks_num: 3
      extra_disks_size: 15G
      disksize: "{{ [cifmw_libvirt_manager_compute_disksize|int, 50] | max }}"
      memory: "{{ [cifmw_libvirt_manager_compute_memory|int, 8] | max }}"
      cpus: "{{ [cifmw_libvirt_manager_compute_cpus|int, 4] | max }}"
      nets:
        - dcn2_pb
        - dcn2_tr

networking_mapper_definition_patch:
  networks:
    external:
      network: "10.0.0.0/24"
      vlan: 44
      mtu: 1496
    ctlplane0:
      network: "192.168.122.0/24"
      is_trunk_parent: true
      mtu: 1500
    ctlplane1:
      network: "192.168.133.0/24"
      is_trunk_parent: true
      mtu: 1500
    ctlplane2:
      network: "192.168.144.0/24"
      is_trunk_parent: true
      mtu: 1500
    internalapi0:
      network: "172.17.0.0/24"
      vlan: 20
      mtu: 1496
      trunk-parent: ctlplane0
    internalapi1:
      network: "172.17.10.0/24"
      vlan: 30
      mtu: 1496
      trunk-parent: ctlplane1
    internalapi2:
      network: "172.17.20.0/24"
      vlan: 40
      mtu: 1496
      trunk-parent: ctlplane2
    tenant0:
      network: "172.19.0.0/24"
      vlan: 22
      mtu: 1496
      trunk-parent: ctlplane0
    tenant1:
      network: "172.19.10.0/24"
      vlan: 32
      mtu: 1496
      trunk-parent: ctlplane1
    tenant2:
      network: "172.19.20.0/24"
      vlan: 42
      mtu: 1496
      trunk-parent: ctlplane2
    storage0:
      network: "172.18.0.0/24"
      vlan: 21
      mtu: 1496
      trunk-parent: ctlplane0
    storage1:
      network: "172.18.10.0/24"
      vlan: 31
      mtu: 1496
      trunk-parent: ctlplane1
    storage2:
      network: "172.18.20.0/24"
      vlan: 41
      mtu: 1496
      trunk-parent: ctlplane2
    storagemgmt0:
      network: "172.20.0.0/24"
      vlan: 23
      mtu: 1496
      trunk-parent: ctlplane0
    storagemgmt1:
      network: "172.20.10.0/24"
      vlan: 33
      mtu: 1496
      trunk-parent: ctlplane1
    storagemgmt2:
      network: "172.20.20.0/24"
      vlan: 43
      mtu: 1496
      trunk-parent: ctlplane2

  group-templates:
    computes:
      network-template:
        # ensure this range does not collide with osp-computes one, even if we
        # don't create any vms for the compute group (the computes for
        # greenfield jobs) we need to make sure their ip ranges do not overlap
        range:
          start: 200
          length: 1
    dcn1-compute-az1s:
      network-template:
        range:
          start: 201
          length: 1
    dcn2-compute-az2s:
      network-template:
        range:
          start: 202
          length: 1
    osp-controllers:
      network-template:
        range:
          start: 103
          length: 3
      networks: &osp_nets
        ctlplane0: {}
        external:
          trunk-parent: ctlplane0
        internalapi0: {}
        tenant0: {}
        storage0: {}
        storagemgmt0: {}
    osp-computes:
      network-template:
        range:
          start: 106
          length: 3
      networks:
        ctlplane0: {}
        internalapi0: {}
        tenant0: {}
        storage0: {}
        storagemgmt0: {}
    osp-underclouds:
      network-template:
        range:
          start: 100
          length: 1
      networks: *osp_nets
    osp-dcn1-compute-az1s:
      network-template:
        range:
          start: 111
          length: 10
      networks:
        ctlplane1: {}
        internalapi1: {}
        tenant1: {}
        storage1: {}
        storagemgmt1: {}
    osp-dcn2-compute-az2s:
      network-template:
        range:
          start: 121
          length: 10
      networks:
        ctlplane2: {}
        internalapi2: {}
        tenant2: {}
        storage2: {}
        storagemgmt2: {}